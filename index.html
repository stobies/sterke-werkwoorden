<!DOCTYPE html>
<html manifest="app.appcache">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" sizes="192x192" href="favicon.png">
  <link rel="icon" type="image/png" href="favicon.png" />
  <title>Sterke Werkwoorden</title>
  <script src="ow.js"></script>
  <script src="watleuk.js"></script>
  <script>
  let ow;
  let answerIx;
  let total;
  let totalOk = 0;
  let totalError = 0;
  let wasIncorrectInput = false;
  let currentLanguage = 'en';
  const AVAILABLE_LANGUAGES = ['en', 'de'];
  const LANGUAGE_NAMES = {'en': 'English', 'de': 'Deutsch'};
  
  const WORDLISTS = {
      'complete': { name: 'Complete list', data: OwList },
      'watleuk': { name: 'Wat leuk', data: WatLeukList }
  };
  let selectedList = null;
  
  function getTranslation(translationObj) {
      if (typeof translationObj === 'string') {
          // Old format - just a string
          return translationObj;
      }
      // New format - dictionary with languages
      if (translationObj[currentLanguage]) {
          return translationObj[currentLanguage];
      }
      // Fallback to English
      return translationObj['en'] || JSON.stringify(translationObj);
  }
  
  function detectBrowserLanguage() {
      const browserLang = navigator.language || navigator.userLanguage || 'en';
      const langCode = browserLang.split('-')[0].toLowerCase();
      return AVAILABLE_LANGUAGES.includes(langCode) ? langCode : 'en';
  }
  
  function setLanguage(lang) {
      if (AVAILABLE_LANGUAGES.includes(lang)) {
          currentLanguage = lang;
          localStorage.language = lang;
          updateLanguageDisplay();
      }
  }
  
  function updateLanguageDisplay() {
      // Update language buttons
      AVAILABLE_LANGUAGES.forEach(lang => {
          const btn = document.getElementById(`lang-${lang}`);
          if (btn) {
              btn.classList.toggle('active', lang === currentLanguage);
          }
      });
      // Update game display if game is running
      if (ow) {
          document.querySelector('.meaning').innerHTML = getTranslation(ow[4]);
      }
  }
  function next() {
      if (!OwList.length) {
          const row = document.querySelector('.row');
          row.innerHTML = `Done! ${totalOk} / ${total}`;
          row.classList.add('results');
          document.querySelector('.meaning').innerHTML = '';
          return;
      }
      const ix = Math.floor(Math.random() * OwList.length);
      ow = OwList[ix];
      OwList.splice(ix, 1);
      answerIx = Math.floor(Math.random() * 4);
      wasIncorrectInput = false;
      ow.forEach((part, ix) => {
          if (ix > 3) {
              document.querySelector('.meaning').innerHTML = getTranslation(part);
              return;
          }
          const value = ix === answerIx ? '' : part;
          const txt = document.getElementById(`txt${ix}`);
          txt.readOnly = ix !== answerIx;
          txt.value = value;
          if (ix === answerIx) {
              txt.focus();
          }
      });
  }
  function onInput(e) {
      if (!localStorage.submitWithReturn && e.target.value === ow[answerIx] ||
          e.target.value.indexOf('?') >= 0) {
          showCorrectAnswer();
      }
  }
  function onKeyDown(e) {
      if (localStorage.submitWithReturn && (e.keyCode || e.which) === 13) {
          const incorrect = e.target.value !== ow[answerIx];
          wasIncorrectInput = wasIncorrectInput || incorrect;
          if (incorrect) {
              const txt = document.getElementById(`txt${answerIx}`);
              txt.classList.add('error');
              setTimeout(() => txt.classList.remove('error'), 200);
          } else {
              showCorrectAnswer();
          }
      }
  }
  function showCorrectAnswer() {
      const txt = document.getElementById(`txt${answerIx}`);
      const isError = txt.value.indexOf('?') >= 0;
      txt.classList.add(isError ? 'error' : 'ok');
      if (isError || wasIncorrectInput) {
          txt.value = ow[answerIx];
          totalError++;
      } else {
          totalOk++;
      }
      txt.readOnly = true;
      showProgress();
      setTimeout(function() {
         txt.classList.remove('ok', 'error');
         next();
     }, isError ? 1000 : 300);
  }
  function showProgress() {
      document.getElementById('progress-ok').style.width = (totalOk / total * 100) + '%';
      document.getElementById('progress-error').style.width = (totalError / total * 100) + '%';
  }
  function init() {
      // Initialize language
      currentLanguage = localStorage.language || detectBrowserLanguage();
      
      // Setup language buttons
      document.querySelectorAll('[id^="lang-"]').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const lang = e.target.id.replace('lang-', '');
              setLanguage(lang);
          });
      });
      updateLanguageDisplay();
      
      document.querySelectorAll('input').forEach(input => {
          input.addEventListener('input', onInput);
          input.addEventListener('keydown', onKeyDown);
      });
      document.querySelectorAll('.submit-with-return').forEach(check => {
          check.addEventListener('click', () => {
              if (localStorage.submitWithReturn) {
                  delete localStorage.submitWithReturn;
              } else {
                  localStorage.submitWithReturn = true;
              }
              showSubmitWithReturn();
          });
      });
      showSubmitWithReturn();
      showStartPage();
  }
  function showStartPage() {
      document.querySelector('.start-page').style.display = 'flex';
      document.querySelector('.game-area').style.display = 'none';
  }
  function startGame() {
      const listKey = document.getElementById('wordlist-select').value;
      selectedList = WORDLISTS[listKey].data.map(item => [...item]);
      total = selectedList.length;
      totalOk = 0;
      totalError = 0;
      document.getElementById('progress-ok').style.width = '0%';
      document.getElementById('progress-error').style.width = '0%';
      document.querySelector('.start-page').style.display = 'none';
      document.querySelector('.game-area').style.display = 'block';
      OwList = selectedList;
      next();
  }
  function showSubmitWithReturn() {
      document.querySelector('.submit-with-return').classList.toggle('active', !!localStorage.submitWithReturn);
  }
  setTimeout(init);
  </script>
  <style>
  body, html {
      height: 100%;
      min-height: 100%;
  }
  body {
      font-family: -apple-system, Helvetica, Arial;
      padding: 0;
      margin: 0;
      font-size: 30px;
      background: #282B33;
  }
  .row {
      display: flex;
      justify-content: space-between;
      padding-top: 2%;
  }
  .row.results {
      color: #ABB2BE;
  }
  @media screen and (max-width: 800px) {
      .row {
          flex-direction: column;
          justify-content: flex-start;
      }
  }
  .results {
      padding: 20px;
      justify-content: center;
  }
  .item {
      padding: 20px;
      position: relative;
  }
  label {
      display: block;
      padding: 4px 8px;
      font-size: 10px;
      color: #5A606A;
  }
  input {
      display: block;
      width: 90%;
      font-size: 30px;
      padding: 4px 8px;
      transition: background-color 300ms linear, border-color 300ms linear;
      outline: none;
      border-radius: 2px;
      border: 2px solid #555C66;
      background: #282B33;
      color: #ABB2BE;
  }
  input[readOnly] {
      border-color: transparent;
  }
  input.ok {
      background-color: #242E2E;
      border-color: #74C892;
  }
  input.error {
      background-color: #312426;
      border-color: #FF644E;
  }
  .progress {
      display: flex;
  }
  #progress-ok, #progress-error {
      height: 2px;
      width: 0;
      transition: width 100ms linear;
  }
  #progress-ok {
      background: #54F176;
      box-shadow: 0 0 3px #242E2E;
  }
  #progress-error {
      background: #FF644E;
      box-shadow: 0 0 3px #312426;
  }
  .meaning {
      color: #5A606A;
      text-align: center;
      padding: 30px 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
  }
  .footer {
      color: #5A606A;
      font-size: 12px;
      text-align: center;
      width: 100%;
      padding: 10px 0;
      opacity: .3;
  }
  .submit-with-return {
      position: fixed;
      right: 10px;
      bottom: 10px;
      color: #373A43;
      font-family: monospace;
      cursor: pointer;
      font-size: 14px;
      transition: color 100ms ease-out;
  }
  .submit-with-return.active, .submit-with-return.active:hover {
      color: #555C66;
  }
  .submit-with-return:hover {
      color: #3d414b;
  }
  .language-selector {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
  }
  .lang-btn {
      padding: 6px 12px;
      background: #3d414b;
      color: #5A606A;
      border: 1px solid #555C66;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-family: -apple-system, Helvetica, Arial;
      transition: all 100ms ease-out;
  }
  .lang-btn:hover {
      background: #444a54;
      color: #6b7280;
  }
  .lang-btn.active {
      background: #54F176;
      color: #282B33;
      border-color: #54F176;
  }
  .start-page {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
  }
  .start-content {
      text-align: center;
  }
  .start-content h1 {
      color: #ABB2BE;
      margin-bottom: 30px;
  }
  .list-selector {
      margin-bottom: 30px;
  }
  .list-selector label {
      color: #5A606A;
      font-size: 16px;
      display: block;
      margin-bottom: 10px;
  }
  .list-selector select {
      font-size: 18px;
      padding: 10px 20px;
      background: #3d414b;
      color: #ABB2BE;
      border: 1px solid #555C66;
      border-radius: 4px;
      cursor: pointer;
  }
  .start-btn {
      font-size: 20px;
      padding: 12px 40px;
      background: #54F176;
      color: #282B33;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-family: -apple-system, Helvetica, Arial;
  }
  .start-btn:hover {
      background: #45d865;
  }
  .game-area {
      display: none;
  }
  </style>
</head>
<body>
    <div class="start-page">
        <div class="start-content">
            <h1>Sterke Werkwoorden</h1>
            <div class="list-selector">
                <label for="wordlist-select">Woordenlijst:</label>
                <select id="wordlist-select">
                    <option value="complete">Complete list</option>
                    <option value="watleuk">Wat leuk</option>
                </select>
            </div>
            <button class="start-btn" onclick="startGame()">Start</button>
        </div>
    </div>
    <div class="game-area">
    <div class="progress">
        <div id="progress-error"></div>
        <div id="progress-ok"></div>
    </div>
    <div class="row">
        <div class="item">
            <label for="txt0">Infinitief</label>
            <input type="text" id="txt0" autocomplete="off" autocapitalize="off" spellcheck="false" autocorrect="off" />
        </div>
        <div class="item">
            <label for="txt0">Verleden tijd enkelvoud</label>
            <input type="text" id="txt1" autocomplete="off" autocapitalize="off" spellcheck="false" autocorrect="off" />
        </div>
        <div class="item">
            <label for="txt0">Verleden tijd meervoud</label>
            <input type="text" id="txt2" autocomplete="off" autocapitalize="off" spellcheck="false" autocorrect="off" />
        </div>
        <div class="item">
            <label for="txt0">Voltooid deelwoord</label>
            <input type="text" id="txt3" autocomplete="off" autocapitalize="off" spellcheck="false" autocorrect="off" />
        </div>
    </div>
    <div class="meaning">
    </div>
    <div class="language-selector">
        <button id="lang-en" class="lang-btn">English</button>
        <button id="lang-de" class="lang-btn">Deutsch</button>
    </div>
    <div class="submit-with-return">⏎</div>
    <div class="footer">
        Typ "?" om het antwoord te zien. ⟨⟩ met ♡ door Antelle.
    </div>
    </div>
</body>
</html>
